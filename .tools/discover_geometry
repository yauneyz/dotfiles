#!/usr/bin/env bash
# get_geometry.sh
# Lets you select a rectangle and outputs its coordinates nicely.

set -euo pipefail

# Ensure slurp is installed
if ! command -v slurp >/dev/null 2>&1; then
  echo "Error: 'slurp' is not installed. Install it with:"
  echo "  NixOS: Add 'slurp' to your packages"
  echo "  Arch: sudo pacman -S slurp"
  exit 1
fi

echo "üëâ Drag a box on the screen to select your region..."
# slurp outputs: "X,Y WIDTHxHEIGHT" (e.g., "100,200 300x400")
# This is the CORRECT format for grim - no conversion needed!
# (Note: maim used "WIDTHxHEIGHT+X+Y" but grim uses "X,Y WIDTHxHEIGHT")
SLURP_OUT=$(slurp)

# Parse slurp output for display purposes
# Format: "X,Y WIDTHxHEIGHT"
X=$(echo "$SLURP_OUT" | cut -d',' -f1)
Y=$(echo "$SLURP_OUT" | cut -d',' -f2 | cut -d' ' -f1)
WIDTH=$(echo "$SLURP_OUT" | cut -d' ' -f2 | cut -d'x' -f1)
HEIGHT=$(echo "$SLURP_OUT" | cut -d' ' -f2 | cut -d'x' -f2)

# Use slurp's output directly - it's already in the correct format for grim!
GEOM="${SLURP_OUT}"

echo
echo "üìè Geometry summary:"
echo "  Left:   $X"
echo "  Top:    $Y"
echo "  Width:  $WIDTH"
echo "  Height: $HEIGHT"
echo
echo "‚úÖ grim geometry format:"
echo "  ${GEOM}"
